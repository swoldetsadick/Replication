csur92 <- read.table("./csur92.txt", header = TRUE)
csur95 <- read.table("./csur95.txt", header = TRUE)
csur98 <- read.table("./csur98.txt", header = TRUE)
csur01 <- read.table("./csur01.txt", header = TRUE)
merge7 <- merge(merge(csur92, csur95, all.x = TRUE, all.y = TRUE), merge(csur98, csur01, all.x = TRUE, all.y = TRUE), all.x = TRUE, all.y = TRUE)
merge7 <- merge7[order(merge7$identif, merge7$anno),]
### Generating lags
library(lubridate)
merge7 <-  within(merge7, {
detab <- ave(eta, identif, FUN = function(x) c(NA, diff(x)))
roa1 <- ave(roa, identif, FUN = function(x) c(NA, x[-length(x)]))
danno <- ave(year(merge7$anno), identif, FUN = function(x) c(NA, diff(x)))
})
#A <- subset(merge7, detab!=1 & !is.na(detab))
#A <- data.frame(cbind(A$identif, as.character(year(A$anno))))
#B <- subset(merge7, danno!=1 & !is.na(danno))
#B <- data.frame(cbind(B$identif, as.character(year(B$anno))))
#C <- subset(merge7, detab!=1 & !is.na(detab)&danno==1)
#C <- data.frame(cbind(C$identif, as.character(year(C$anno))))
#D <- subset(merge7, danno!=1 & !is.na(danno))
#D <- data.frame(cbind(D$identif, as.character(year(D$anno))))
#View(A)
#View(B)
#View(C)
#View(D)
merge7$dip <- ifelse(year(merge7$anno)==1989,merge7$dip89,ifelse(year(merge7$anno)==1990,merge7$dip90,ifelse(year(merge7$anno)==1991,merge7$dip91,ifelse(year(merge7$anno)==1992,merge7$dip92,ifelse(year(merge7$anno)==1993,merge7$dip93,ifelse(year(merge7$anno)==1994,merge7$dip94,ifelse(year(merge7$anno)==1995,merge7$dip95,ifelse(year(merge7$anno)==1996,merge7$dip96,ifelse(year(merge7$anno)==1997,merge7$dip97,ifelse(year(merge7$anno)==1998,merge7$dip98,ifelse(year(merge7$anno)==1999,merge7$dip99,merge7$dip00)))))))))))
merge7$identif <- as.factor(merge7$identif)
# Creating identif LAG by identif
E <- data.frame(as.factor(merge7$identif))
G <- data.frame(rbind(as.character(NA), E))
G <- data.frame(G[-nrow(G),])
H <- data.frame(cbind(E, G))
colnames(H) <- c("nlg", "lg1")
H$rl <- ifelse(H$nlg == H$lg1, as.character(H$nlg), NA)
# Creating identif LEAD by identif
I <- data.frame(rbind(E, as.character(NA)))
I <- data.frame(I[-1,])
J <- data.frame(cbind(E, I))
colnames(J) <- c("nad", "ad1")
J$ra <- ifelse(J$nad == J$ad1, as.character(J$nad), NA)
# identif LAG is called id1 and LEAD id3 (by identif)
merge7$id1 <- H$rl
merge7$id3 <- J$ra
# creating dip1, dip2 and dip3 variables which represent number of firms by identif
# lagged one time, two times and leaded one time respectively
suppressMessages(library(data.table))
merge7 <- data.table(merge7, key = "identif")
merge7[,c("dip1") := list(c(NA, dip[-.N])), by = identif]
merge7[,c("dip2") := list(c(NA, dip1[-.N])), by = identif]
merge7 <- merge7[order(merge7$identif, merge7$anno, decreasing = TRUE)]
merge7[,c("dip3") := list(c(NA, dip[-.N])), by = identif]
merge7 <- merge7[order(merge7$identif, merge7$anno, decreasing = FALSE)]
# Interpolating possible missing values of number of employees in firm
# Missing value is filled by averaging the number of employees in firm
# exactly from one year before and after if they exist for the specific firm
merge7$dip <- ifelse(is.na(merge7$dip) & !is.na(merge7$dip3) & !is.na(merge7$dip1) & merge7$id1 == merge7$id3, (merge7$dip3+merge7$dip1)/2, merge7$dip)
# Growth rate in number of employees (ddip)
merge7$ddip <- ((merge7$dip-merge7$dip1)/merge7$dip1)
# log of number of employees the same year for the specific firm, a year before
# and two years before (resp. ldip, ldip1 and ldip2)
suppressWarnings(merge7$ldip <- ifelse(is.infinite(log(merge7$dip)), NA, log(merge7$dip)))
suppressWarnings(merge7$ldip1 <- ifelse(is.infinite(log(merge7$dip1)), NA, log(merge7$dip1)))
suppressWarnings(merge7$ldip2 <- ifelse(is.infinite(log(merge7$dip2)), NA, log(merge7$dip2)))
merge7 <- data.frame(merge7)
merge7$id1 <- NULL
merge7$id3 <- NULL
merge7$dip1 <- NULL
merge7$dip2 <- NULL
merge7$dip3 <- NULL
library(foreign)
merge <- read.dta("C:/Users/anton_000/Documents/Downloads/Desktop/compare/maka.dta")
summary(merge$dip - merge7$dip)
sum(is.na(merge$dip))
sum(is.na(merge7$dip))
summary(merge$ldip - merge7$ldip)
sum(is.na(merge$ldip))
sum(is.na(merge7$ldip))
summary(merge$ldip1 - merge7$ldip1)
sum(is.na(merge$ldip1))
sum(is.na(merge7$ldip1))
summary(merge$ldip2 - merge7$ldip2)
sum(is.na(merge$ldip2))
sum(is.na(merge7$ldip2))
14458-14517
25164-25223
summary(merge$danno - merge7$danno)
summary(merge$detab - merge7$detab)
summary(merge$roa1 - merge7$roa1)
summary(merge$danno - merge7$danno)
sum(is.na(merge$danno))
sum(is.na(merge7$danno))
summary(merge$detab - merge7$detab)
sum(is.na(merge$detab))
sum(is.na(merge7$detab))
summary(merge$roa1 - merge7$roa1)
sum(is.na(merge$roa1))
sum(is.na(merge7$roa1))
summary(merge$ldip1 - merge7$ldip1)
sum(is.na(merge$ldip1)) - sum(is.na(merge7$ldip1))
summary(merge$ldip2 - merge7$ldip2)
sum(is.na(merge$ldip2)) - sum(is.na(merge7$ldip2))
merge$ind1 <- identical(merge$ldip1,merge7$ldip1)
merge$ind2 <- identical(merge$ldip2,merge7$ldip2)
a <- subset(merge, ind1 == "FALSE")
View(a)
merge$ind1 <- identical(merge$ldip1-merge7$ldip1==0,1,0)
merge$ind2 <- identical(merge$ldip2-merge7$ldip2==0,1,0)
a <- subset(merge, ind1 == 1)
merge$ind1 <- ifelse(round(merge$ldip1-merge7$ldip1, digits=2)==0,1,0)
merge$ind2 <- ifelse(round(merge$ldip2-merge7$ldip2, digits=2)==0,1,0)
a <- subset(merge, ind1 == 1)
a <- subset(merge, ind1 == 0)
merge$ind1 <- ifelse(is.na(merge7$ldip1) & !is.na(merge$ldip1), 1, 0)
merge$ind2 <- ifelse(is.na(merge7$ldip2) & !is.na(merge$ldip2), 1, 0)
a <- subset(merge, ind1 == 1)
View(a)
b <- subset(merge, ind2 == 1)
View(b)
c <- c(a$identif,a$anno)
d <- c(b$identif,b$anno)
c <- data.frame(c(a$identif,a$anno))
c <- data.frame(cbind(a$identif,a$anno))
d <- data.frame(cbind(b$identif,b$anno))
View(c)
View(d)
